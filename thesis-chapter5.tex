%(1) Algorithm
%(2) Time series result and validation
%(3) Deformation maps
%(4) Data now available for stakeholders, what people can do (brief discussion on Peter's work, we could use one of his figures I have).
%



\chapter{Robust Time Series Methods for Long-term Nonlinear Deformation}
\label{CHAP:5-robust-ts}


In this chapter, present a method for robustly extracting slow-moving cumulative surface deformation from time series with large noise. 
We perform a temporal smoothing using the robust LOcally WEighted Scatterplot Smoothing (LOWESS) regression technique \cite{Cleveland1979RobustLocallyWeighted} on noisy surface deformation time-series derived using SBAS.
%The method extends the ideas behind the outlier-removal technique presented in Chapter \ref{CHAP:4-GRL}.
Compared to the alternatives presenting in Section \ref{sec:ch4-method-compare}, the LOWESS smoothing more easily accounts for nonlinear deformation while also suppressing the 10-15 cm of tropospheric noise present in the summer SAR acquisitions. 
We demonstrate the technique using synthetic time series and using three paths of Sentinel-1 data over the Permian Basin in West Texas. 
The cumulative results show subtle basin-wide uplift features arising after 4-5 years of heavy sustained wastewater injection.



%- Problem: 
%1. Longer time series, the linear assumption becomes less valid.  This is at odds with the balance of using more measurements to average out tropospheric noise
%2. Methods incorporating temporal smoothness constraints (Find a few. e.g. Karissa? other temp smooth solvers...) or temp lienar filtering methods get influenced by strong tropo days. Even with smoothing, there are anomalous bumps 
%	- can get interpreted as deformation if we assume that all movements remaining after filtering are due to the low-pass deformation
%	

\section{Algorithm}
%	\bm{A \phi} = \bm{\Delta \phi} + \bm{\epsilon} . \label{eq:ch2-sbas-A}
%where  $\bm{A}$ is the system design matrix, and $ \bm{\epsilon}  $ is the vector of interferogram-specific noise sources (e.g. $ \Delta \phi_{decor}, \Delta \phi_{unwrap}, \Delta \phi_{scat}, \Delta \phi_{n} $ from Equation \eqref{eq:ch2-insar-noise-terms}).
Consider time series of LOS phase delay,  $ \bm{\phi} = \left[\phi_0, \phi_1, \ldots, \phi_{N-1} \right]^T $, for a single pixel solved using the SBAS system from Equation \eqref{eq:ch2-sbas-A}.
Here we consider the case that the interferogram-specific noise sources (e.g. $  \Delta \phi_{decor}, \Delta \phi_{unwrap}, \Delta \phi_{scat}  $) have been properly accounted for in the process used to calculate $ \bm{\phi} $.
Each element $\phi_i$ contains
% consists of all terms in Equation \eqref{eq:ch2-insar-noise-terms} which affect the phase of a SAR acquisition and all interferograms containing that acquisition
the deformation phase, $\frac{4 \pi}{\lambda} d_i$, as well as the atmospheric delay terms, $\frac{4 \pi}{\lambda} \alpha_i$.
Since deformation is usually the quantity of interest, there are several approaches to separating $ d_i $ from $ \alpha_i $.
If a functional model of deformation is known to exist (e.g. linear, transient jumps \citep{Chen20142010SlowSlip, Fielding2017SurfaceDeformationNorth}, seasonal variations \citep{Murray2018ShortLivedPause}, or a combination \citep{Riel2018QuantifyingGroundDeformation}), a model fit can be performed on the noisy $ \bm{\phi} $ time series to extract the model parameters of interest.
Alternatively, the authors of \cite{Berardino2002NewAlgorithmSurface} used spatial and temporal filters on $\bm{\Delta \phi}$, relying on the fact that the turbulent component of $\bm{\alpha}$ is uncorrelated in time \citep{Emardson2003NeutralAtmosphericDelay} while most deformation sources show strong temporal correlation.

%These filters are expanded upon and compared in Chapter \ref{CHAP:5-robust-ts}, where a new robust filter is presented to separate deformation from atmospheric noise.


\begin{figure}
\centering
%\includegraphics[width=.99\textwidth]{figures/chapter5-lowess/figure1-demo.pdf}
\caption[Demo of LOWESS fitting]{
	Demo of LOWESS fitting
	(a) fake time series to fit
	(b) weighting window
	(c) slope at one point
}
\label{fig:ch5-algo-demo}
\end{figure}


%
%%$ \bm{v} = (\bm{A}^T \bm{A})^{-1}\bm{A}^T \bm{\Delta \phi} $
%%As noted in \cite{Simons2007InterferometricSyntheticAperture}, 
%The least squares solution $ \bm{v} = (\bm{B}^T \bm{B})^{-1}\bm{B}^T \bm{\Delta \phi} $ (or minimum norm solution n $ \bm{v} = \bm{B}^{\dagger} \bm{\Delta \phi}$ ) from \cite{Berardino2002NewAlgorithmSurface} assume that all measurements in $\bm{\Delta \phi}$ have equal variance; subsequent authors have implemented a weighted least squares solution:
%\begin{equation}
%	%	\bm{\phi} = \bm{A}^{\dagger} \bm{\Delta \phi}
%	%	\bm{\phi} = (\bm{A}^T \bm{\Sigma}^{-1} \bm{A})^{-1}\bm{A}^T \bm{\Sigma}^{-1} \bm{\Delta \phi}  \label{eq:ch2-sbas-wls}
%	\bm{v} = (\bm{B}^T \bm{\Sigma}^{-1} \bm{B})^{-1}\bm{B}^T \bm{\Sigma}^{-1} \bm{\Delta \phi}  \label{eq:ch2-sbas-wls}
%\end{equation}
%where $ \bm{\Sigma} = \mathbb{E}[\bm{\epsilon} \bm{\epsilon}^T] $ is the measurement covariance matrix.




\begin{figure}
	\centering
%	\includegraphics[width=.99\textwidth]{figures/chapter5-lowess/figure1-demo.pdf}
	\caption[Effect of window size on LOWESS fit]{
		(a) Using a narrow window 
		(b) Using a wide window approaches a single linear fit
	}
	\label{fig:ch5-algo-window}
\end{figure}


\begin{figure}
	\centering
%	\includegraphics[width=.99\textwidth]{figures/chapter5-lowess/figure1-demo.pdf}
	\caption[Multiple iterations of LOWESS fit]{
		(a) First round fit at one $ x $ location (Same as Figure \ref{fig:ch5-algo-demo}c)
		(b) Additional weights imposed from the residuals of first fit
		(c) New weighting window
		(d) Improved fit from second and third iterations
	}
	\label{fig:ch5-algo-iteration}
\end{figure}


\section{Synthetic Example}



\begin{figure}
	\centering
%	\includegraphics[width=.99\textwidth]{figures/chapter5-lowess/figure1-demo.pdf}
	\caption[Multiple iterations of LOWESS fit]{
		(a) First round fit at one $ x $ location (Same as Figure \ref{fig:ch5-algo-demo}c)
		(b) Additional weights imposed from the residuals of first fit
		(c) New weighting window
		(d) Improved fit from second and third iterations
	}
	\label{fig:ch5-compare-tri}
\end{figure}



\section{InSAR Processing for Sentinel-1}

%For Sentinel-1 path 78, we processed all interferograms with temporal baselines less than 500. 
%Since all interferograms had less than 250 meter spatial baseline, we required no maximum spatial baseline threshold.  
%We unwrapped each interferogram using the Statistical-cost, Network-flow Algorithm for Phase Unwrapping (SNAPHU).
We use the Path 78 and Path 85 inteferograms from Section .
We reduce long wavelength and stratified tropospheric noise by removing a combined planar phase ramp and linear phase vs. elevation relation \cite{Doin2009CorrectionsStratifiedTropospheric, Zebker2021AccuracyModelFree}. We used the mean of the pixel values in a window around GPS station TXKM as a reference.
We repeated this process for descending path 85 and ascending path 151. Since path 151 does not contain station TXKM, or any other GPS station near the center of the acquisition, we used the referencing technique presented in \cite{Zebker2021AccuracyModelFree} to fit and remove a phase-elevation trend from all high-coherence pixels in each interferogram. This method relies on the assumption that most pixels in each interferogram do not show significant deformation, which is valid Path 151 which only partially overlaps with the western portion of the oil-producing Permian Basin. 
%our signals deform slowly over time

%FIGURE: 3 path study

%For each pixel, we solved for the cumulative line of sight path delay for all SAR acquisition dates using the SBAS linear system.
%The path delay consist of the true relative surface deformation on each date and a tropospheric noise component, which can lead to jumps of 10 cm or more between consecutive dates.
%Since the atmospheric noise is correlated in space but uncorrelated in time, previous authors have isolated and mitigated the atmospheric noise by using a high pass temporal filter followed by a 2D spatial low pass filter
%\cite{Ferretti2000NonlinearSubsidenceRate, Ferretti2001PermanentScatterersSar, Berardino2002NewAlgorithmSurface, Hooper2012RecentAdvancesSar}.
%Here we perform a temporal smoothing using the robust locally weighted regression (LOWESS) method \cite{Cleveland1979RobustLocallyWeighted}. For each pixel, LOWESS performs multiple iterations of weighted linear regression at each point in the time series. The method weights nearby points more heavily than far away points. We use a window size such that at least two years of SAR acquisitions are weighted for each date, with more points considered during times of regular acquisitions.
%Subsequent iterations use the residuals of the data points from the smoothed line to further deweight noisy acquisitions. Points with residuals larger than 6 times the median absolute residual are clipped to have 0 weight in future iterations. In this manner, the smoothing is robust to strong tropospheric turbulence noise that would otherwise leak into neighboring days using a moving average temporal filter. Additionally, since LOWESS assumes no underlying model, the smoothing can accommodate nonlinear deformation.
%
%To mitigate final residual long wavelength tropospheric noise, we remove quadratic ramp from the phase of each date in the time series (where we mask out pixels with $>$2 cm of estimated deformation to avoid removing deformation) \cite{Morishita2020LicsbasOpenSource}.

\section{Results}

\subsection{Permian Basin 7-year time series}

\subsection{GPS comparison}

\section{Discussion}

%1. Limitations of stacking to long time series
%2. Robust Time Series Methods
   %1. Regularization (Supplement from GRL)
   %2. LOWESS smoothing
%3. Synthetic Example
%4. 7 Year Time Series for the Permian Basin
%1. Comparison to GPS
%2. Anthropogenic Caused Deformation Patterns


%Problems with pixelwise uq
%- Image of blob, with 8 mm cutoff, question which part you trust and not
%- Leads into feature-wise uq




